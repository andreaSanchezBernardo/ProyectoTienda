<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    @*<link rel="stylesheet" href="~/Content/StyleSheetTienda.css" />*@
    <title>@ViewBag.Title - Mi aplicación ASP.NET</title>
    @Styles.Render("~/Content/Tienda")
    @Styles.Render("~/Content/css")
    @*@Scripts.Render("~/bundles/modernizr")*@
</head>
<body>
    <header>
        <nav>
            <div class="icono">
                <a href="@Url.Action("Inicio","Tienda")">Inicio</a>
                <img src="~/iconos/hogar.png" />
            </div>
            <div class="icono">
                <select class="marca opciones" id="marca">
                    <option value="" hidden>Marcas</option>
                </select>
                <img src="~/iconos/marcos.png" />
            </div>
            <div class="icono">
                <select class="categoria opciones" id="categoria">
                    <option value="" hidden>Productos</option>
                </select>
                <img src="~/iconos/estrellao.png" />
            </div>
            <div class="icono">
                <a href="">Cesta</a>
                <img src="~/iconos/carro-de-la-compra.png" />
            </div>
            <div class="icono">
                <select class="opciones" id="userActions">
                    <option value="" hidden>Usuario</option>
                    <option value="1">Iniciar Sesión</option>
                    <option value="0">Cerrar Sesión</option>
                </select>
                <img src="~/iconos/usuario.png" />
            </div>
        </nav>
    </header>
    <main>
        <div>
            @RenderBody()

        </div>
        <!-- Formulario -->
        <div class="formulario" id="loginForm">
            <div class="cuadro">
                <form id="frr">
                    <div class="sesion">
                        <h2>INICIAR SESION</h2>
                        <input type="hidden" id="usuarioId" />
                        <input type="hidden" id="cbActivo" />
                        <label for="correo" class="form-label">Email</label>
                        <input type="text" id="correo" name="correo" class="form-control" />
                        <label for="clave" class="form-label">Contraseña</label>
                        <input type="password" id="clave" name="clave" class="form-control" />
                        <a href="#" class="enlace">He olvidado la contraseña</a>
                        <a href="@Url.Action("NuevaSesion","Tienda")" class="enlace">Crear Cuenta</a>
                    </div>
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary" id="loginForm">Continuar</button>
                        <button type="button" class="btn btn-warning" id="closeForm">Cerrar</button>
                    </div>
                </form>
            </div>
        </div>
    </main>
    <footer class="footer">
        <div class="footer__addr">
            <h1 class="footer__logo">Something</h1>

            <h2>Contact</h2>

            <address>
                5534 Somewhere In. The World 22193-10212<br>

                <a class="footer__btn" href="mailto:example@gmail.com">Email Us</a>
            </address>
        </div>

        <ul class="footer__nav">
            <li class="nav__item">
                <h2 class="nav__title">Media</h2>

                <ul class="nav__ul">
                    <li>
                        <a href="#">Online</a>
                    </li>

                    <li>
                        <a href="#">Print</a>
                    </li>

                    <li>
                        <a href="#">Alternative Ads</a>
                    </li>
                </ul>
            </li>

            <li class="nav__item nav__item--extra">
                <h2 class="nav__title">Technology</h2>

                <ul class="nav__ul nav__ul--extra">
                    <li>
                        <a href="#">Hardware Design</a>
                    </li>

                    <li>
                        <a href="#">Software Design</a>
                    </li>

                    <li>
                        <a href="#">Digital Signage</a>
                    </li>

                    <li>
                        <a href="#">Automation</a>
                    </li>

                    <li>
                        <a href="#">Artificial Intelligence</a>
                    </li>

                    <li>
                        <a href="#">IoT</a>
                    </li>
                </ul>
            </li>

            <li class="nav__item">
                <h2 class="nav__title">Legal</h2>

                <ul class="nav__ul">
                    <li>
                        <a href="#">Privacy Policy</a>
                    </li>

                    <li>
                        <a href="#">Terms of Use</a>
                    </li>

                    <li>
                        <a href="#">Sitemap</a>
                    </li>
                </ul>
            </li>
        </ul>

        <div class="legal">
            <p>&copy; 2019 Something. All rights reserved.</p>

            <div class="legal__links">
                <span>Made with <span class="heart">♥</span> remotely from Anywhere</span>
            </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const userActions = document.getElementById('userActions');
            const loginForm = document.getElementById('loginForm');
            const closeFormButton = document.getElementById('closeForm');

            userActions.addEventListener('change', function () {
                if (this.value === '1') { // Iniciar Sesion
                    loginForm.style.display = 'block';
                }
            });

            closeFormButton.addEventListener('click', function () {
                loginForm.style.display = 'none';
                userActions.value = ''; // Resetear el select
            });
        });

        $(document).ready(function () {
            $('#frr').on('submit', function (event) {
                event.preventDefault();// Evita el comportamiento por defecto del formulario


                const idUsuario = $('#usuarioId').val();
                const correo = $('#correo').val();
                const clave = $('#clave').val();
                const activo = $('#cbActivo').val();

                const formData = {
                    IdUsuario: idUsuario, // Asegúrate de que este campo exista y tenga sentido en tu contexto
                    Correo: correo,
                    Clave: clave,
                    Activo: activo,
                };

                  // Realiza la solicitud AJAX

              var url = '@Url.Action("Acceso", "Tienda")';
              $.ajax({
                  url: url,
                  type: 'POST',
                  contentType: 'application/json',
                  data: JSON.stringify(formData),
                  dataType: 'json', // Indica que esperas una respuesta JSON
                  success: function (response) {
                      if (response.success) {
                          console.log(response.success)
                        window.location.href = '@Url.Action("Index", "Tienda")';
                    } else {
                        alert(response.mensaje);
                    }
                    console.log(response);
                  },
                  error: function (error) {
                      // Maneja los errores
                      alert(error.responseJSON.mensaje);
                      console.log(error);
                  }
              });

            })
        })

         $(document).ready(function () {
        // Realiza una solicitud AJAX para obtener la lista de categorías desde el controlador
        $.ajax({
            url: '@Url.Action("ListarCategoria", "Mantenimiento")',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                // Itera sobre los datos recibidos y agrega opciones al select
                $.each(data.data, function (index, categoria) {
                    $('#categoria').append($('<option>', {
                        value: categoria.IdCategoria,
                        text: categoria.Descripcion
                    }));
                });

                // Agrega un controlador de eventos de clic a las opciones del select
                $('#categoria').change(function () {
                    var selectedCategoria = $(this).val();
                    if (selectedCategoria !== "") {
                        // Construye la URL de redirección con el ID de la categoría seleccionada
                        var url = '@Url.Action("PaginaCategoria", "Tienda")' + '?idCategoria=' + selectedCategoria;
                        // Redirige a la URL construida
                        window.location.href = url;
                    }
                });
            },
            error: function (error) {
                console.log(error);
            }
        });
         });

        /////
        $(document).ready(function () {
    // Realiza una solicitud AJAX para obtener la lista de categorías desde el controlador
            $.ajax({
                url: '@Url.Action("ListarMarca", "Mantenimiento")',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    // Itera sobre los datos recibidos y agrega opciones al select
                    $.each(data.data, function (index, marca) {
                        $('#marca').append($('<option>', {
                            value: marca.IdMarca,
                            text: marca.Descripcion
                        }));
                    });

            // Agrega un controlador de eventos de clic a las opciones del select
            $('#marca').change(function () {
                var selectedMarca = $(this).val();
                if (selectedMarca !== "") {
                    // Construye la URL de redirección con el ID de la categoría seleccionada
                    var url = '@Url.Action("PaginaMarca", "Tienda")' + '?idMarca=' + selectedMarca;
                    // Redirige a la URL construida
                    window.location.href = url;
                }
            });
        },
        error: function (error) {
            console.log(error);
        }
    });
});
    </script>

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/complementos")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)

</body>

